<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>GitHub cPanel Lite</title>
<style>
body{font-family:sans-serif;padding:20px;background:#f3f6fb;}
input,textarea,button{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ddd;box-sizing:border-box;}
button{background:#2b6ef6;color:#fff;border:none;cursor:pointer;}
h2{margin-bottom:10px;}
#messages{background:#eef;padding:10px;border-radius:6px;min-height:30px;white-space:pre-wrap;}
</style>
</head>
<body>
<h2>GitHub cPanel Lite</h2>

<label>عملیات</label>
<select id="action">
  <option value="create">ساخت فایل جدید</option>
  <option value="edit">ویرایش فایل موجود</option>
  <option value="delete">حذف فایل</option>
</select>

<label>نام فایل</label>
<input id="filename" placeholder="index.html">

<label>محتوا (برای ایجاد یا ویرایش)</label>
<textarea id="content" rows="6"></textarea>

<label>شاخه هدف</label>
<input id="branch" placeholder="main">

<button id="submitBtn">اجرای عملیات</button>

<div id="messages"></div>

<script>
const el = id => document.getElementById(id);
const showMsg = msg => el('messages').textContent = msg;

el('submitBtn').addEventListener('click', async ()=>{
    const action = el('action').value;
    const filename = el('filename').value.trim();
    const content = el('content').value;
    const branch = el('branch').value.trim() || 'main';
    
    if(!filename){ showMsg('لطفا نام فایل را وارد کنید'); return; }

    const files_json = JSON.stringify([{filename, content}]);

    showMsg("⏳ در حال ارسال درخواست به workflow...");

    // ⚠️ توجه: نیاز به GitHub Personal Access Token (PAT) با دسترسی workflow دارید
    const GITHUB_USER = 'rdnsparham-rgb';
    const GITHUB_REPO = 'V1';
    const GITHUB_TOKEN = prompt('لطفا GitHub Token خود را وارد کنید (ایمن نگه دارید)');

    const workflow_id = 'cpanel-like.yml';
    const response = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/actions/workflows/${workflow_id}/dispatches`,{
        method:'POST',
        headers:{
            'Accept':'application/vnd.github+json',
            'Authorization':'Bearer '+GITHUB_TOKEN
        },
        body: JSON.stringify({
            ref: branch,
            inputs: {
                action,
                files_json,
                target_branch: branch
            }
        })
    });

    if(response.status === 204){
        showMsg(`✅ درخواست شما با موفقیت ارسال شد.
لطفا چند ثانیه صبر کنید تا workflow اجرا شود.
بعد از اجرا، لینک نهایی فایل روی GitHub Pages به شکل زیر خواهد بود:
https://rdnsparham-rgb.github.io/V1/<RAND>/${filename}

(RAND پوشه رندم توسط workflow ایجاد می‌شود و بعد از اجرای Actions دقیقاً مشخص خواهد شد.)`);
    } else {
        const err = await response.json();
        showMsg('❌ خطا در ارسال درخواست:\n'+JSON.stringify(err,null,2));
    }
});
</script>
</body>
</html>
