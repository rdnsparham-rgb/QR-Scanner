<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>GitHub Workflow Trigger</title>
<style>
body{font-family:sans-serif;padding:20px;background:#f3f6fb;}
input,textarea,button{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ddd;box-sizing:border-box;}
button{background:#2b6ef6;color:#fff;border:none;cursor:pointer;}
</style>
</head>
<body>
<h2>Trigger GitHub Workflow</h2>

<label>Owner (مثال: rdnsparham-rgb)</label>
<input id="owner" placeholder="Owner">

<label>Repo (مثال: V1)</label>
<input id="repo" placeholder="Repo">

<label>Workflow file (مثال: create-folder.yml)</label>
<input id="workflow" placeholder="Workflow file name">

<label>Folder Prefix</label>
<input id="prefix" placeholder="V1">

<label>Files JSON</label>
<textarea id="files" rows="6">[{"filename":"index.html","content":"<h1>سلام از cPanel</h1>"}]</textarea>

<label>GitHub Token (PAT با دسترسی workflow)</label>
<input id="token" placeholder="توکن شخصی">

<button id="triggerBtn">Trigger Workflow</button>

<pre id="out"></pre>

<script>
const el = id=>document.getElementById(id);
const out = msg => el('out').textContent = typeof msg==='string'?msg:JSON.stringify(msg,null,2);

el('triggerBtn').addEventListener('click', async ()=>{
  const owner = el('owner').value.trim();
  const repo = el('repo').value.trim();
  const workflow_id = el('workflow').value.trim();
  const token = el('token').value.trim();
  const prefix = el('prefix').value.trim();
  let files_json;
  try{ files_json = JSON.parse(el('files').value); }catch(e){ return alert('JSON فایل‌ها معتبر نیست'); }

  if(!owner||!repo||!workflow_id||!token) return alert('همه فیلدها پر شود');

  const url = `https://api.github.com/repos/${owner}/${repo}/actions/workflows/${workflow_id}/dispatches`;

  try{
    const resp = await fetch(url,{
      method:'POST',
      headers:{
        'Accept':'application/vnd.github+json',
        'Authorization':'Bearer '+token
      },
      body: JSON.stringify({
        ref: 'main',
        inputs:{
          folder_prefix: prefix,
          files_json: JSON.stringify(files_json)
        }
      })
    });
    if(resp.ok) out('Workflow triggered successfully!');
    else {
      const j = await resp.json();
      out({status:resp.status, message:j});
    }
  }catch(e){ out('Error: '+e.message); }
});
</script>
</body>
</html>
