name: cpanel-like

on:
  workflow_dispatch:
    inputs:
      action:
        description: 'Ù†ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª (create / edit / delete)'
        required: true
      files_json:
        description: 'Ù„ÛŒØ³Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª JSON [{"filename":"index.html","content":"<h1>hi</h1>"}]'
        required: true
      target_branch:
        description: 'Ù†Ø§Ù… Ø´Ø§Ø®Ù‡ Ù‡Ø¯Ù (Ù…Ø«Ù„Ø§Ù‹ main)'
        required: true

jobs:
  manage_files:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Parse JSON and Apply Changes
        run: |
          echo "ğŸš€ Ø´Ø±ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª cPanel-like"
          mkdir -p temp_changes
          echo '${{ inputs.files_json }}' > temp_changes/files.json
          cat temp_changes/files.json

          FOLDER=$(cat /dev/urandom | tr -dc a-z0-9 | head -c 8)
          echo "Ù¾ÙˆØ´Ù‡ Ø±Ù†Ø¯Ù…: $FOLDER"

          mkdir -p "$FOLDER"

          echo '${{ inputs.files_json }}' | jq -c '.[]' | while read file; do
            NAME=$(echo $file | jq -r '.filename')
            CONTENT=$(echo $file | jq -r '.content')

            if [ "${{ inputs.action }}" = "delete" ]; then
              echo "ğŸ—‘ Ø­Ø°Ù ÙØ§ÛŒÙ„: $NAME"
              rm -f "$NAME"
            else
              echo "âœï¸ Ø§ÛŒØ¬Ø§Ø¯/ÙˆÛŒØ±Ø§ÛŒØ´ ÙØ§ÛŒÙ„: $NAME"
              echo "$CONTENT" > "$FOLDER/$NAME"
            fi
          done

      - name: Commit & Push Changes
        run: |
          git config --global user.name "cpanel-bot"
          git config --global user.email "cpanel-bot@example.com"

          git add .
          COMMIT_MSG="CPanel Action: ${{ inputs.action }}"
          git commit -m "$COMMIT_MSG" || echo "Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø¨Ø±Ø§ÛŒ commit"
          git push origin ${{ inputs.target_branch }}

      - name: Display File URLs
        run: |
          echo "âœ… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¯Ù†Ø¯!"
          echo "ğŸ”— Ù„ÛŒÙ†Ú© GitHub Pages Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡:"
          echo "https://rdnsparham-rgb.github.io/V1/${FOLDER}/"
