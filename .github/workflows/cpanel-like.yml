name: CPanel-like File Creator

on:
  issues:
    types: [opened]

jobs:
  create-file:
    if: startsWith(github.event.issue.title, 'create:')
    runs-on: ubuntu-latest

    steps:
      - name: Generate Random Folder
        id: random
        run: echo "RAND=$(cat /dev/urandom | tr -dc A-Z | head -c 7)" >> $GITHUB_ENV

      - name: Clone Repository
        uses: actions/checkout@v4

      - name: Create File
        run: |
          FILE_NAME=$(echo "${{ github.event.issue.title }}" | sed 's/create://g')
          mkdir -p V1/$RAND
          echo "${{ github.event.issue.body }}" > V1/$RAND/$FILE_NAME
          git config --global user.name "CPanel Bot"
          git config --global user.email "bot@github.com"
          git add .
          git commit -m "ğŸ§© Created file $FILE_NAME in $RAND"
          git push

      - name: Comment Back with Link
        env:
          GH_TOKEN: ${{ secrets.MY_TOKEN }}
        run: |
          FILE_NAME=$(echo "${{ github.event.issue.title }}" | sed 's/create://g')
          COMMENT="âœ… ÙØ§ÛŒÙ„ Ø´Ù…Ø§ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯!\nğŸ”— Ù„ÛŒÙ†Ú© ÙØ§ÛŒÙ„:\nhttps://${{ github.repository_owner }}.github.io/V1/$RAND/$FILE_NAME"
          gh api repos/${{ github.repository }}/issues/${{ github.event.issue.number }}/comments -f body="$COMMENT"
